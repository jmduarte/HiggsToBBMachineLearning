

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Week 2 Notebook: Data Formats and Exploration &#8212; Particle Physics and Machine Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Week 3: Feature Engineering" href="03.html" />
    <link rel="prev" title="Week 2: Data Formats and Exploration" href="02.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Particle Physics and Machine Learning</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Particle Physics and Machine Learning
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01.html">
   Week 1: Introduction to Particle Physics and Jets
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="02.html">
   Week 2: Data Formats and Exploration
  </a>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Week 2 Notebook: Data Formats and Exploration
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.html">
   Week 3: Feature Engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04.html">
   Week 4: Simple Classifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05.html">
   Week 5: Building a Deep Learning Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06.html">
   Week 6: Evalulating Model Performance and Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07.html">
   Week 7: Optimizing Other Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08.html">
   Week 8: Application to Real Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09.html">
   Week 9: Extending the Model
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/weeks/02-dataset.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jmduarte/HiggsToBBMachineLearning/dsc?urlpath=tree/weeks/02-dataset.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://datahub.ucsd.edu/hub/user-redirect/git-pull?repo=https://github.com/jmduarte/HiggsToBBMachineLearning&urlpath=tree/HiggsToBBMachineLearning/weeks/02-dataset.ipynb&branch=dsc"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/jmduarte/HiggsToBBMachineLearning/blob/dsc/weeks/02-dataset.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remote-files">
   Remote files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#xrootd-filenames">
   XRootD filenames
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trees">
   Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-note-on-jaggedness">
   A note on “jaggedness”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jagged-arrys">
   Jagged arrys
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operations-with-jaggedness">
   Operations with jaggedness
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conversion-to-regular-array">
   Conversion to regular array
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="week-2-notebook-data-formats-and-exploration">
<h1>Week 2 Notebook: Data Formats and Exploration<a class="headerlink" href="#week-2-notebook-data-formats-and-exploration" title="Permalink to this headline">¶</a></h1>
<p>Particle physics uses a data format (and analysis ecosystem) based on the <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> library: https://root.cern.ch/.
<code class="docutils literal notranslate"><span class="pre">ROOT</span></code> is a framework for data processing, born at CERN, at the heart of the research on high-energy physics.
A <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> file is a compressed binary file in which we can save objects of any type.
There are python bindings built into <code class="docutils literal notranslate"><span class="pre">ROOT</span></code>, so called <code class="docutils literal notranslate"><span class="pre">PyROOT</span></code>, but for now we won’t discuss this.</p>
<p>Recently, a different library called <code class="docutils literal notranslate"><span class="pre">uproot</span></code> has been developed allowing python users to do <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> I/O directly: https://uproot.readthedocs.io/en/latest/.
<code class="docutils literal notranslate"><span class="pre">uproot</span></code> is a reader and a writer of the <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> file format using only <code class="docutils literal notranslate"><span class="pre">Python</span></code> and <code class="docutils literal notranslate"><span class="pre">Numpy</span></code>.
Unlike the standard C++ <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> implementation, uproot is only an I/O library, primarily intended to stream data into machine learning libraries in <code class="docutils literal notranslate"><span class="pre">Python</span></code>.
Unlike <code class="docutils literal notranslate"><span class="pre">PyROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">root_numpy</span></code>, uproot does not depend on C++ <code class="docutils literal notranslate"><span class="pre">ROOT</span></code>.
Instead, it uses <code class="docutils literal notranslate"><span class="pre">Numpy</span></code> to cast blocks of data from the <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> file as <code class="docutils literal notranslate"><span class="pre">Numpy</span></code> arrays.</p>
<p>For a tutorial on <code class="docutils literal notranslate"><span class="pre">uproot</span></code>, see: https://hsf-training.github.io/hsf-training-uproot-webpage/ or here: https://github.com/jpivarski-talks/2020-07-13-pyhep2020-tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uproot</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="remote-files">
<h2>Remote files<a class="headerlink" href="#remote-files" title="Permalink to this headline">¶</a></h2>
<p>One nice feature of <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">uproot</span></code> is the ability to read a file remotely.
This is done using the <code class="docutils literal notranslate"><span class="pre">XRootD</span></code> library: https://xrootd.slac.stanford.edu/.
<code class="docutils literal notranslate"><span class="pre">XRootD</span></code> is a generic suite for fast, low latency and scalable data access, which can serve natively any kind of data, organized as a hierarchical filesystem-like namespace, based on the concept of directory.</p>
</div>
<div class="section" id="xrootd-filenames">
<h2>XRootD filenames<a class="headerlink" href="#xrootd-filenames" title="Permalink to this headline">¶</a></h2>
<p>We specify that this is a remote file accessed via <code class="docutils literal notranslate"><span class="pre">XRootD</span></code> using the <code class="docutils literal notranslate"><span class="pre">root://</span></code> protocol in front of the filename.
The redirector <code class="docutils literal notranslate"><span class="pre">eospublic.cern.ch</span></code> specifies that we’re accessing data from the CERN open data repository.
And finally the rest of the file name <code class="docutils literal notranslate"><span class="pre">/eos/opendata/cms/datascience/HiggsToBBNtupleProducerTool/HiggsToBBNTuple_HiggsToBB_QCD_RunII_13TeV_MC/train/ntuple_merged_10.root</span></code> specifies the exact file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">uproot</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;root://eospublic.cern.ch//eos/opendata/cms/datascience/HiggsToBBNtupleProducerTool/HiggsToBBNTuple_HiggsToBB_QCD_RunII_13TeV_MC/train/ntuple_merged_10.root&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="trees">
<h2>Trees<a class="headerlink" href="#trees" title="Permalink to this headline">¶</a></h2>
<p>One common object is a tree.
Trees in <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> are basically just tables of information.
Trees are composed of branches, which are the columns of the table.
The rows usually represent events (individual bunch crossings).
However, in this case, each row represents a jet (a localized collection of particles within a single event).</p>
<p>First we assign the tree to a variable (named <code class="docutils literal notranslate"><span class="pre">tree</span></code> here).
We can see how many rows (jets) are contained in the tree, by checking its length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;deepntuplizer/tree&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200000
</pre></div>
</div>
</div>
</div>
<p>Let’s list the contents (branches) of the tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Delta_gen_pt               (no streamer)              asdtype(&#39;&gt;f4&#39;)
event_no                   (no streamer)              asdtype(&#39;&gt;u4&#39;)
gen_pt                     (no streamer)              asdtype(&#39;&gt;f4&#39;)
isB                        (no streamer)              asdtype(&#39;&gt;i4&#39;)
isBB                       (no streamer)              asdtype(&#39;&gt;i4&#39;)
isC                        (no streamer)              asdtype(&#39;&gt;i4&#39;)
isG                        (no streamer)              asdtype(&#39;&gt;i4&#39;)
isLeptonicB                (no streamer)              asdtype(&#39;&gt;i4&#39;)
isLeptonicB_C              (no streamer)              asdtype(&#39;&gt;i4&#39;)
isS                        (no streamer)              asdtype(&#39;&gt;i4&#39;)
isUD                       (no streamer)              asdtype(&#39;&gt;i4&#39;)
isUndefined                (no streamer)              asdtype(&#39;&gt;i4&#39;)
jet_corr_pt                (no streamer)              asdtype(&#39;&gt;f4&#39;)
jet_eta                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
jet_looseId                (no streamer)              asdtype(&#39;&gt;f4&#39;)
jet_no                     (no streamer)              asdtype(&#39;&gt;u4&#39;)
jet_phi                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
jet_pt                     (no streamer)              asdtype(&#39;&gt;f4&#39;)
jet_tightId                (no streamer)              asdtype(&#39;&gt;f4&#39;)
npv                        (no streamer)              asdtype(&#39;&gt;f4&#39;)
ntrueInt                   (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfBoostedDoubleSecondaryVertexAK8BJetTags
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfCombinedInclusiveSecondaryVertexV2BJetTags
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfCombinedMVAV2BJetTags    (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_probb     (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_probbb    (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_probc     (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_probcc    (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_probudsg  (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfJetBProbabilityBJetTags  (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfJetProbabilityBJetTags   (no streamer)              asdtype(&#39;&gt;f4&#39;)
rho                        (no streamer)              asdtype(&#39;&gt;f4&#39;)
softPFElectronBJetTags     (no streamer)              asdtype(&#39;&gt;f4&#39;)
softPFMuonBJetTags         (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_doubleb                 (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_eta                     (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_gen_eta                 (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_gen_pt                  (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_isBB                    (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_isH                     (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_isNonBB                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_isQCD                   (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_isTop                   (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_isW                     (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_isZ                     (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_jetNTracks              (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_label                   (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_labelJMAR               (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_labelLegacy             (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_mass                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_nSV                     (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_n_sdsubjets             (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_nbHadrons               (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_ncHadrons               (no streamer)              asdtype(&#39;&gt;i4&#39;)
fj_phi                     (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_pt                      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_ptDR                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_relptdiff               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdmass                  (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdn2                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_axis1             (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_axis2             (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_csv               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_eta               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_mass              (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_mult              (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_phi               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_pt                (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj1_ptD               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_axis1             (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_axis2             (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_csv               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_eta               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_mass              (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_mult              (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_phi               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_pt                (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_sdsj2_ptD               (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau0_trackEtaRel_0      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau0_trackEtaRel_1      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau0_trackEtaRel_2      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau1                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau1_trackEtaRel_0      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau1_trackEtaRel_1      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau1_trackEtaRel_2      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau2                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau21                   (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau3                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau32                   (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_flightDistance2dSig_0
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_flightDistance2dSig_1
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_vertexDeltaR_0      (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_vertexEnergyRatio_0 (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_vertexEnergyRatio_1 (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_vertexMass_0        (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_tau_vertexMass_1        (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSip2dSigAboveBottom_0
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSip2dSigAboveBottom_1
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSip2dSigAboveCharm_0
                           (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_0          (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_0_0        (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_0_1        (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_1          (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_1_0        (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_1_1        (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_2          (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_3          (no streamer)              asdtype(&#39;&gt;f4&#39;)
fj_z_ratio                 (no streamer)              asdtype(&#39;&gt;f4&#39;)
label_H_bb                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_H_cc                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_H_qqqq               (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_QCD_b                (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_QCD_bb               (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_QCD_c                (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_QCD_cc               (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_QCD_others           (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Top_bc               (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Top_bcq              (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Top_bq               (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Top_bqq              (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_W_cq                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_W_qq                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Z_bb                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Z_cc                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
label_Z_qq                 (no streamer)              asdtype(&#39;&gt;i4&#39;)
sample_isQCD               (no streamer)              asdtype(&#39;&gt;i4&#39;)
n_pfcands                  (no streamer)              asdtype(&#39;&gt;i4&#39;)
npfcands                   (no streamer)              asdtype(&#39;&gt;f4&#39;)
pfcand_VTX_ass             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_charge              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_deltaR              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_drminsv             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_drsubjet1           TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_drsubjet2           TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_dxy                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_dxysig              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_dz                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_dzsig               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_erel                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_etarel              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_fromPV              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_hcalFrac            TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_isChargedHad        TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_isEl                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_isGamma             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_isMu                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_isNeutralHad        TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_lostInnerHits       TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_mass                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_phirel              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_ptrel               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
pfcand_puppiw              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
n_tracks                   (no streamer)              asdtype(&#39;&gt;i4&#39;)
ntracks                    (no streamer)              asdtype(&#39;&gt;f4&#39;)
trackBTag_DeltaR           TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_Eta              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_EtaRel           TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_JetDistVal       TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_Momentum         TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_PPar             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_PParRatio        TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_PtRatio          TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_PtRel            TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_Sip2dSig         TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_Sip2dVal         TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_Sip3dSig         TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
trackBTag_Sip3dVal         TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_VTX_ass              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_charge               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_deltaR               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_detadeta             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dlambdadz            TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dphidphi             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dphidxy              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dptdpt               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_drminsv              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_drsubjet1            TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_drsubjet2            TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dxy                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dxydxy               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dxydz                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dxysig               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dz                   TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dzdz                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_dzsig                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_erel                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_etarel               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_fromPV               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_isChargedHad         TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_isEl                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_isMu                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_lostInnerHits        TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_mass                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_normchi2             TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_phirel               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_pt                   TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_ptrel                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_puppiw               TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
track_quality              TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
n_sv                       (no streamer)              asdtype(&#39;&gt;i4&#39;)
nsv                        (no streamer)              asdtype(&#39;&gt;f4&#39;)
sv_chi2                    TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_costhetasvpv            TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_d3d                     TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_d3derr                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_d3dsig                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_deltaR                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_dxy                     TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_dxyerr                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_dxysig                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_erel                    TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_etarel                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_mass                    TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_ndf                     TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_normchi2                TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_ntracks                 TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_phirel                  TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_pt                      TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
sv_ptrel                   TStreamerSTL               asjagged(asdtype(&#39;&gt;f4&#39;), 10)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-note-on-jaggedness">
<h2>A note on “jaggedness”<a class="headerlink" href="#a-note-on-jaggedness" title="Permalink to this headline">¶</a></h2>
<p>Some branches are listed has having an interpretation of <code class="docutils literal notranslate"><span class="pre">asdtype('&gt;f4')</span></code> while some others are listed as <code class="docutils literal notranslate"><span class="pre">asjagged(asdtype('&gt;f4'),</span> <span class="pre">10)</span></code>.
The former means there is only one number per jet.
The latter means there may a variable number per jet.</p>
<p>First, let’s get just look at non-jagged arrays, starting with the ground truth labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a dictionary</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label_QCD_b&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_bb&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_c&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_cc&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_others&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_H_bb&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;sample_isQCD&#39;</span><span class="p">],</span> 
                     <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                     <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;label_QCD_b&#39;: array([0, 0, 0, ..., 0, 0, 0], dtype=int32),
 &#39;label_QCD_bb&#39;: array([0, 0, 0, ..., 0, 0, 0], dtype=int32),
 &#39;label_QCD_c&#39;: array([0, 0, 0, ..., 0, 0, 0], dtype=int32),
 &#39;label_QCD_cc&#39;: array([0, 0, 0, ..., 0, 1, 1], dtype=int32),
 &#39;label_QCD_others&#39;: array([1, 1, 1, ..., 1, 0, 0], dtype=int32),
 &#39;label_H_bb&#39;: array([0, 0, 0, ..., 0, 0, 0], dtype=int32),
 &#39;sample_isQCD&#39;: array([1, 1, 1, ..., 1, 1, 1], dtype=int32)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># label QCD: require the sample to be QCD and any of the QCD flavors</span>
<span class="n">label_QCD</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;sample_isQCD&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_b&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_bb&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_c&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_cc&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_others&#39;</span><span class="p">])</span>

<span class="c1"># label Hbb</span>
<span class="n">label_Hbb</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_H_bb&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of overlap jets</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">label_QCD</span><span class="o">*</span><span class="n">label_Hbb</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fraction of jets with some truth label defined </span>
<span class="nb">sum</span><span class="p">(</span><span class="n">label_QCD</span><span class="o">+</span><span class="n">label_Hbb</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">label_QCD</span><span class="o">+</span><span class="n">label_Hbb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.93785
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># jet features, namely transverse momemntum (pt) and soft-drop mass  (sdmass or msd)</span>
<span class="n">jet_features</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">,</span> 
                                     <span class="s1">&#39;fj_sdmass&#39;</span><span class="p">],</span>
                          <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                          <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_QCD</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;QCD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_Hbb</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;H(bb)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jet $p_</span><span class="si">{T}</span><span class="s1">$ [GeV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of jets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_sdmass&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_QCD</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;QCD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_sdmass&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_Hbb</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;H(bb)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jet $m_</span><span class="si">{SD}</span><span class="s1">$ [GeV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of jets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02-dataset_14_0.png" src="../_images/02-dataset_14_0.png" />
<img alt="../_images/02-dataset_14_1.png" src="../_images/02-dataset_14_1.png" />
</div>
</div>
</div>
<div class="section" id="jagged-arrys">
<h2>Jagged arrys<a class="headerlink" href="#jagged-arrys" title="Permalink to this headline">¶</a></h2>
<p>Now let’s look at a jagged array, like those related to track features, where there can be a variable number of tracks per jet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;label_H_bb&#39;</span><span class="p">],</span>
                             <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                             <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">track_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;track_pt&#39;: &lt;JaggedArray [[1.0537109 0.95654297 1.4570312 ... 18.171875 1.6171875 1.234375] [2.7832031 3.5253906 49.09375 ... 3.8613281 1.4599609 1.4306641] [1.5302734 6.8164062 2.9257812 ... 25.6875 36.3125 1.1513672] ... [1.0810547 2.5234375 10.265625 ... 1.25 24.453125 8.4921875] [4.8125 2.6796875 3.9824219 ... 4.3359375 23.375 6.3242188] [2.4101562 1.4345703 2.4628906 ... 57.59375 1.0419922 2.9726562]] at 0x7f3f71964490&gt;,
 &#39;label_H_bb&#39;: array([0, 0, 0, ..., 0, 0, 0], dtype=int32)}
</pre></div>
</div>
</div>
</div>
<p>Note the difference between a “flat” array, where these a fixed number per jet (like 1 per jet in the case of jet properties) and a jagged array, where there are a variable number.</p>
<p>We can demonstrate this by looking at the first jet in the dataset. As we’ll see there are 21 tracks, each with their own pt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>251.27692
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1.0537109 ,  0.95654297,  1.4570312 ,  1.0917969 ,  3.1660156 ,
        3.3886719 ,  6.8554688 ,  3.4257812 ,  1.8662109 ,  2.890625  ,
        7.5898438 ,  1.4970703 ,  5.0117188 , 62.875     ,  7.0195312 ,
       11.125     ,  4.5429688 , 14.125     , 18.171875  ,  1.6171875 ,
        1.234375  ], dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>Note, behind the scenes jagged arrays are just like normal numpy arrays, except there’s additional structure, ecoded in the starts/stops/counts vectors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">starts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([     0,     21,     56, ..., 542149, 542174, 542194])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stops</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([    21,     56,     80, ..., 542174, 542194, 542239])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([21, 35, 24, ..., 25, 20, 45])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="operations-with-jaggedness">
<h2>Operations with jaggedness<a class="headerlink" href="#operations-with-jaggedness" title="Permalink to this headline">¶</a></h2>
<p>We can plot the full distibution of track pts. But what if we want to find the highest track pt per jet and plot only that?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;All tracks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Max. $p_</span><span class="si">{T}</span><span class="s1">$ track per jet&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Track $p_</span><span class="si">{T}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of tracks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02-dataset_25_0.png" src="../_images/02-dataset_25_0.png" />
</div>
</div>
</div>
<div class="section" id="conversion-to-regular-array">
<h2>Conversion to regular array<a class="headerlink" href="#conversion-to-regular-array" title="Permalink to this headline">¶</a></h2>
<p>Sometimes we want to turn a jagged array into a regular array to make it easier to accomodate into a machine learning algorithm (like a fully conneted or convolutional neural network).
The simplest way to do this is to use zero-padding and truncation to “cap” the number of objects at some fixed value, and zero-pad if there are less objects.</p>
<p>To do this, we can first plot how many tracks there are per jet and choose a reasonable number to cap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">counts</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Number of tracks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of jets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02-dataset_27_0.png" src="../_images/02-dataset_27_0.png" />
</div>
</div>
<p>In this case, 60 seems to be a reasonable number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">regular</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">a</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(20000, 60)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.0537109 ,  0.95654297,  1.4570312 , ...,  0.        ,
         0.        ,  0.        ],
       [ 2.7832031 ,  3.5253906 , 49.09375   , ...,  0.        ,
         0.        ,  0.        ],
       [ 1.5302734 ,  6.8164062 ,  2.9257812 , ...,  0.        ,
         0.        ,  0.        ],
       ...,
       [ 1.0810547 ,  2.5234375 , 10.265625  , ...,  0.        ,
         0.        ,  0.        ],
       [ 4.8125    ,  2.6796875 ,  3.9824219 , ...,  0.        ,
         0.        ,  0.        ],
       [ 2.4101562 ,  1.4345703 ,  2.4628906 , ...,  0.        ,
         0.        ,  0.        ]], dtype=float32)
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./weeks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="02.html" title="previous page">Week 2: Data Formats and Exploration</a>
    <a class='right-next' id="next-link" href="03.html" title="next page">Week 3: Feature Engineering</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Javier Duarte<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>